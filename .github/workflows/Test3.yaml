name: Test3

on:
  workflow_dispatch:

defaults:
  run:
    shell: pwsh

permissions:
  contents: read
  id-token: write

jobs:
  Testjob:
    runs-on: ubuntu-latest

    steps:
      - name: Investigate
        run: |
          Write-Host $ENV:ACTIONS_ID_TOKEN_REQUEST_URL
          Write-Host $ENV:ACTIONS_ID_TOKEN_REQUEST_TOKEN
          $token = Invoke-RestMethod -Method GET -Headers @{ "Authorization" = "bearer $ENV:ACTIONS_ID_TOKEN_REQUEST_TOKEN" } -Uri "$ENV:ACTIONS_ID_TOKEN_REQUEST_URL&audience=api://AzureADTokenExchange"
          $token.GetType() | Out-Host
          az login --federated-token $token.value --allow-no-subscriptions
          az account list

