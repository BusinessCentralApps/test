name: Simple Matrix

on:
  workflow_dispatch:

defaults:
  run:
    shell: PowerShell

jobs:
  job1:
    runs-on: windows-latest
    outputs:
      environments: ${{steps.environments.outputs.environments}}
    steps:
    - name: environments
      id: environments
      run: |
        $environments = @{ "include" = @( @{ "environmentName" = "google"; "url" = "http://www.google.com"}, @{ "environmentName" = "bing"; "url" = "http://www.bing.com" } ) } | ConvertTo-Json -compress
        Write-Host "::set-output name=environments::$($environments | ConvertTo-Json -compress)"
        $json = $environments | ConvertTo-Json -compress
        write-host $json
  job2:
    runs-on: windows-latest
    needs: [ job1 ]
    strategy:
      matrix:
        include:
        - url: 'https://www.google.com'
          environmentName: google
        - url: 'https://www.bing.com'
          environmentName: bing
    steps:
    - name: Output name and url
      run: |
        Write-Host '${{ matrix.environmentName }} ${{ matrix.url }}'
