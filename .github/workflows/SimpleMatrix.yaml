name: Simple Matrix

on:
  workflow_dispatch:

defaults:
  run:
    shell: PowerShell

jobs:
  Environments:
    runs-on: windows-latest
    outputs:
      environments: ${{steps.Environments.outputs.environments}}
    steps:
    - name: environments
      id: environments
      run: |
        $environments = @{ "include" = @( @{ "environmentName" = "google"; "url" = "http://www.google.com"}, @{ "environmentName" = "bing"; "url" = "http://www.bing.com" } ) } | ConvertTo-Json -compress
        Write-Host "::set-output name=environments::$($environments | ConvertTo-Json -compress)"
        $json = $environments | ConvertTo-Json -compress
        write-host $json
  Country:
    runs-on: windows-latest
    needs: [ Environments ]
    strategy:
      matrix: ${{ needs.Environments.outputs.environments }}
    steps:
    - name: Output name and url
      run: |
        Write-Host '${{ matrix.environmentName }} ${{ matrix.url }}'
